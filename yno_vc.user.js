// ==UserScript==
// @name      YNO Voice Chat
// @version   0.0.1
// @license   MIT OR Apache-2.0
// @source    https://github.com/AcrylonitrileButadieneStyrene/yno-vc
// @match     *://ynoproject.net/*
// @resource  wasm  http://localhost:3000/dist/yno_vc.wasm
// @grant     GM.getResourceUrl
// @grant     GM.getValue
// @grant     GM.setValue
// @grant     unsafeWindow
// ==/UserScript==

(function () {
	'use strict';

	/*
	 * This file has been minified to reduce its file size.
	 * A readable copy of the code is accessible at the link in the @repository tag above.
	 */
	((async function(I){let r;function J(e){r=e;}function l(e){const t=r.__externref_table_alloc();return r.__wbindgen_externrefs.set(t,e),t}const T=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>e.dtor(e.a,e.b));function B(e){const t=typeof e;if(t=="number"||t=="boolean"||e==null)return `${e}`;if(t=="string")return `"${e}"`;if(t=="symbol"){const o=e.description;return o==null?"Symbol":`Symbol(${o})`}if(t=="function"){const o=e.name;return typeof o=="string"&&o.length>0?`Function(${o})`:"Function"}if(Array.isArray(e)){const o=e.length;let c="[";o>0&&(c+=B(e[0]));for(let s=1;s<o;s++)c+=", "+B(e[s]);return c+="]",c}const n=/\[object ([^\]]+)\]/.exec(toString.call(e));let _;if(n&&n.length>1)_=n[1];else return toString.call(e);if(_=="Object")try{return "Object("+JSON.stringify(e)+")"}catch{return "Object"}return e instanceof Error?`${e.name}: ${e.message}
${e.stack}`:_}function y(e,t){return e=e>>>0,R().subarray(e/1,e/1+t)}let p=null;function a(){return (p===null||p.buffer.detached===true||p.buffer.detached===void 0&&p.buffer!==r.memory.buffer)&&(p=new DataView(r.memory.buffer)),p}function f(e,t){return e=e>>>0,be(e,t)}let C=null;function R(){return (C===null||C.byteLength===0)&&(C=new Uint8Array(r.memory.buffer)),C}function i(e,t){try{return e.apply(this,t)}catch(n){const _=l(n);r.__wbindgen_exn_store(_);}}function b(e){return e==null}function ue(e,t,n,_){const o={a:e,b:t,cnt:1,dtor:n},c=(...s)=>{o.cnt++;try{return _(o.a,o.b,...s)}finally{c._wbg_cb_unref();}};return c._wbg_cb_unref=()=>{--o.cnt===0&&(o.dtor(o.a,o.b),o.a=0,T.unregister(o));},T.register(c,o,o),c}function m(e,t,n,_){const o={a:e,b:t,cnt:1,dtor:n},c=(...s)=>{o.cnt++;const u=o.a;o.a=0;try{return _(u,o.b,...s)}finally{o.a=u,c._wbg_cb_unref();}};return c._wbg_cb_unref=()=>{--o.cnt===0&&(o.dtor(o.a,o.b),o.a=0,T.unregister(o));},T.register(c,o,o),c}function g(e,t,n){if(n===void 0){const u=M.encode(e),O=t(u.length,1)>>>0;return R().subarray(O,O+u.length).set(u),d=u.length,O}let _=e.length,o=t(_,1)>>>0;const c=R();let s=0;for(;s<_;s++){const u=e.charCodeAt(s);if(u>127)break;c[o+s]=u;}if(s!==_){s!==0&&(e=e.slice(s)),o=n(o,_,_=s+e.length*3,1)>>>0;const u=R().subarray(o+s,o+_),O=M.encodeInto(e,u);s+=O.written,o=n(o,_,s,1)>>>0;}return d=s,o}let L=new TextDecoder("utf-8",{ignoreBOM:true,fatal:true});L.decode();const fe=2146435072;let U=0;function be(e,t){return U+=t,U>=fe&&(L=new TextDecoder("utf-8",{ignoreBOM:true,fatal:true}),L.decode(),U=t),L.decode(R().subarray(e,e+t))}const M=new TextEncoder;"encodeInto"in M||(M.encodeInto=function(e,t){const n=M.encode(e);return t.set(n),{read:e.length,written:n.length}});let d=0;function de(e,t,n){r.wasm_bindgen_91ae6b94752e5b1f___convert__closures_____invoke___web_sys_d62371c9efa9c7d3___features__gen_CloseEvent__CloseEvent_____(e,t,n);}function ge(e,t){r.wasm_bindgen_91ae6b94752e5b1f___convert__closures_____invoke_______3_(e,t);}function le(e,t){r.wasm_bindgen_91ae6b94752e5b1f___convert__closures_____invoke______(e,t);}function we(e,t){r.wasm_bindgen_91ae6b94752e5b1f___convert__closures_____invoke_______1_(e,t);}function ye(e,t){r.wasm_bindgen_91ae6b94752e5b1f___convert__closures_____invoke_______2_(e,t);}function pe(e,t,n){r.wasm_bindgen_91ae6b94752e5b1f___convert__closures_____invoke___wasm_bindgen_91ae6b94752e5b1f___JsValue_____(e,t,n);}function me(e,t,n){r.wasm_bindgen_91ae6b94752e5b1f___convert__closures_____invoke___web_sys_d62371c9efa9c7d3___features__gen_MessageEvent__MessageEvent_____(e,t,n);}function he(e,t,n,_){r.wasm_bindgen_91ae6b94752e5b1f___convert__closures_____invoke___wasm_bindgen_91ae6b94752e5b1f___JsValue__wasm_bindgen_91ae6b94752e5b1f___JsValue_____(e,t,n,_);}const ve=["blob","arraybuffer"],ke=["bytes"],Se=["default","no-store","reload","no-cache","force-cache","only-if-cached"],Fe=["omit","same-origin","include"],Ee=["same-origin","no-cors","cors","navigate"],G=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>r.__wbg_connection_free(e>>>0,1)),Ie=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>r.__wbg_intounderlyingbytesource_free(e>>>0,1)),Re=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>r.__wbg_intounderlyingsink_free(e>>>0,1)),Me=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>r.__wbg_intounderlyingsource_free(e>>>0,1)),H=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>r.__wbg_network_free(e>>>0,1)),K=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>r.__wbg_networking_free(e>>>0,1)),X=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>r.__wbg_receiver_free(e>>>0,1)),Y=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>r.__wbg_sender_free(e>>>0,1));class h{static __wrap(t){t=t>>>0;const n=Object.create(h.prototype);return n.__wbg_ptr=t,G.register(n,n.__wbg_ptr,n),n}__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,G.unregister(this),t}free(){const t=this.__destroy_into_raw();r.__wbg_connection_free(t,0);}take_receive(){const t=r.connection_take_receive(this.__wbg_ptr);return t===0?void 0:k.__wrap(t)}take_public_key(){const t=r.connection_take_public_key(this.__wbg_ptr);let n;return t[0]!==0&&(n=f(t[0],t[1]).slice(),r.__wbindgen_free(t[0],t[1]*1,1)),n}take_send(){const t=r.connection_take_send(this.__wbg_ptr);return t===0?void 0:S.__wrap(t)}}Symbol.dispose&&(h.prototype[Symbol.dispose]=h.prototype.free);class q{__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,Ie.unregister(this),t}free(){const t=this.__destroy_into_raw();r.__wbg_intounderlyingbytesource_free(t,0);}get autoAllocateChunkSize(){return r.intounderlyingbytesource_autoAllocateChunkSize(this.__wbg_ptr)>>>0}pull(t){return r.intounderlyingbytesource_pull(this.__wbg_ptr,t)}start(t){r.intounderlyingbytesource_start(this.__wbg_ptr,t);}get type(){const t=r.intounderlyingbytesource_type(this.__wbg_ptr);return ke[t]}cancel(){const t=this.__destroy_into_raw();r.intounderlyingbytesource_cancel(t);}}Symbol.dispose&&(q.prototype[Symbol.dispose]=q.prototype.free);class V{__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,Re.unregister(this),t}free(){const t=this.__destroy_into_raw();r.__wbg_intounderlyingsink_free(t,0);}abort(t){const n=this.__destroy_into_raw();return r.intounderlyingsink_abort(n,t)}close(){const t=this.__destroy_into_raw();return r.intounderlyingsink_close(t)}write(t){return r.intounderlyingsink_write(this.__wbg_ptr,t)}}Symbol.dispose&&(V.prototype[Symbol.dispose]=V.prototype.free);class W{__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,Me.unregister(this),t}free(){const t=this.__destroy_into_raw();r.__wbg_intounderlyingsource_free(t,0);}pull(t){return r.intounderlyingsource_pull(this.__wbg_ptr,t)}cancel(){const t=this.__destroy_into_raw();r.intounderlyingsource_cancel(t);}}Symbol.dispose&&(W.prototype[Symbol.dispose]=W.prototype.free);class z{__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,H.unregister(this),t}free(){const t=this.__destroy_into_raw();r.__wbg_network_free(t,0);}init(){const t=this.__destroy_into_raw();return r.network_init(t)}constructor(t){var n=b(t)?0:g(t,r.__wbindgen_malloc,r.__wbindgen_realloc),_=d;const o=r.network_new(n,_);return this.__wbg_ptr=o>>>0,H.register(this,this.__wbg_ptr,this),this}}Symbol.dispose&&(z.prototype[Symbol.dispose]=z.prototype.free);class v{static __wrap(t){t=t>>>0;const n=Object.create(v.prototype);return n.__wbg_ptr=t,K.register(n,n.__wbg_ptr,n),n}__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,K.unregister(this),t}free(){const t=this.__destroy_into_raw();r.__wbg_networking_free(t,0);}accept(){return r.networking_accept(this.__wbg_ptr)}connect(t){const n=g(t,r.__wbindgen_malloc,r.__wbindgen_realloc),_=d;return r.networking_connect(this.__wbg_ptr,n,_)}get_public_key(){let t,n;try{const _=r.networking_get_public_key(this.__wbg_ptr);return t=_[0],n=_[1],f(_[0],_[1])}finally{r.__wbindgen_free(t,n,1);}}get_secret_key(){let t,n;try{const _=r.networking_get_secret_key(this.__wbg_ptr);return t=_[0],n=_[1],f(_[0],_[1])}finally{r.__wbindgen_free(t,n,1);}}}Symbol.dispose&&(v.prototype[Symbol.dispose]=v.prototype.free);class k{static __wrap(t){t=t>>>0;const n=Object.create(k.prototype);return n.__wbg_ptr=t,X.register(n,n.__wbg_ptr,n),n}__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,X.unregister(this),t}free(){const t=this.__destroy_into_raw();r.__wbg_receiver_free(t,0);}read(){return r.receiver_read(this.__wbg_ptr)}}Symbol.dispose&&(k.prototype[Symbol.dispose]=k.prototype.free);class S{static __wrap(t){t=t>>>0;const n=Object.create(S.prototype);return n.__wbg_ptr=t,Y.register(n,n.__wbg_ptr,n),n}__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,Y.unregister(this),t}free(){const t=this.__destroy_into_raw();r.__wbg_sender_free(t,0);}send(t){return r.sender_send(this.__wbg_ptr,t)}}Symbol.dispose&&(S.prototype[Symbol.dispose]=S.prototype.free);function Ae(){r.main();}function Oe(e,t){return Error(f(e,t))}function Te(e){return Number(e)}function Ce(e,t){const n=String(t),_=g(n,r.__wbindgen_malloc,r.__wbindgen_realloc),o=d;a().setInt32(e+4,o,true),a().setInt32(e+0,_,true);}function Le(e,t){const n=t,_=typeof n=="bigint"?n:void 0;a().setBigInt64(e+8,b(_)?BigInt(0):_,true),a().setInt32(e+0,!b(_),true);}function ze(e){const t=e,n=typeof t=="boolean"?t:void 0;return b(n)?16777215:n?1:0}function je(e,t){const n=B(t),_=g(n,r.__wbindgen_malloc,r.__wbindgen_realloc),o=d;a().setInt32(e+4,o,true),a().setInt32(e+0,_,true);}function xe(e,t){return e in t}function Be(e){return typeof e=="bigint"}function Ue(e){return typeof e=="function"}function qe(e){const t=e;return typeof t=="object"&&t!==null}function Ve(e){return typeof e=="string"}function We(e){return e===void 0}function $e(e,t){return e===t}function De(e,t){return e==t}function Pe(e,t){const n=t,_=typeof n=="number"?n:void 0;a().setFloat64(e+8,b(_)?0:_,true),a().setInt32(e+0,!b(_),true);}function Ne(e,t){const n=t,_=typeof n=="string"?n:void 0;var o=b(_)?0:g(_,r.__wbindgen_malloc,r.__wbindgen_realloc),c=d;a().setInt32(e+4,c,true),a().setInt32(e+0,o,true);}function Je(e,t){throw new Error(f(e,t))}function Ge(e){e._wbg_cb_unref();}function He(e){e.abort();}function Ke(e,t){e.abort(t);}function Xe(){return i(function(e,t,n,_){e.addEventListener(f(t,n),_);},arguments)}function Ye(){return i(function(e,t,n,_,o){e.append(f(t,n),f(_,o));},arguments)}function Qe(){return i(function(e){return e.arrayBuffer()},arguments)}function Ze(e){const t=e.body;return b(t)?0:l(t)}function et(e){return e.buffer}function tt(e){const t=e.byobRequest;return b(t)?0:l(t)}function nt(e){return e.byteLength}function _t(e){return e.byteOffset}function rt(){return i(function(e,t,n){return e.call(t,n)},arguments)}function ot(){return i(function(e,t){return e.call(t)},arguments)}function ct(e){return e.cancel()}function it(e,t){return e.catch(t)}function st(e){return clearTimeout(e)}function at(){return i(function(e,t){e.clearTimeout(t);},arguments)}function ut(){return i(function(e){e.close();},arguments)}function ft(){return i(function(e){e.close();},arguments)}function bt(){return i(function(e){e.close();},arguments)}function dt(e){return e.code}function gt(e){return e.code}function lt(e){return h.__wrap(e)}function wt(e){return e.crypto}function yt(e){return e.data}function pt(e){console.debug(e);}function mt(e){return e.done}function ht(){return i(function(e,t){e.enqueue(t);},arguments)}function vt(e){return Object.entries(e)}function kt(e,t){let n,_;try{n=e,_=t,console.error(f(e,t));}finally{r.__wbindgen_free(n,_,1);}}function St(e){console.error(e);}function Ft(e){return fetch(e)}function Et(e,t){return e.fetch(t)}function It(){return i(function(e,t){globalThis.crypto.getRandomValues(y(e,t));},arguments)}function Rt(){return i(function(e,t){e.getRandomValues(t);},arguments)}function Mt(){return i(function(e){return e.getReader()},arguments)}function At(e,t){return e[t>>>0]}function Ot(){return i(function(e,t){return Reflect.get(e,t)},arguments)}function Tt(e){const t=e.done;return b(t)?16777215:t?1:0}function Ct(e){return e.value}function Lt(e,t){return e[t]}function zt(){return i(function(e,t){return Reflect.has(e,t)},arguments)}function jt(e){return e.headers}function xt(e){console.info(e);}function Bt(e){let t;try{t=e instanceof ArrayBuffer;}catch{t=false;}return t}function Ut(e){let t;try{t=e instanceof Blob;}catch{t=false;}return t}function qt(e){let t;try{t=e instanceof Map;}catch{t=false;}return t}function Vt(e){let t;try{t=e instanceof Response;}catch{t=false;}return t}function Wt(e){let t;try{t=e instanceof Uint8Array;}catch{t=false;}return t}function $t(e){return Array.isArray(e)}function Dt(e){return Number.isSafeInteger(e)}function Pt(){return Symbol.iterator}function Nt(e){return e.length}function Jt(e){return e.length}function Gt(e){console.log(e);}function Ht(e,t){const n=t.message,_=g(n,r.__wbindgen_malloc,r.__wbindgen_realloc),o=d;a().setInt32(e+4,o,true),a().setInt32(e+0,_,true);}function Kt(e){return e.msCrypto}function Xt(e){return v.__wrap(e)}function Yt(){return new Object}function Qt(){return new Array}function Zt(){return i(function(){return new Headers},arguments)}function en(e){return new Uint8Array(e)}function tn(){return i(function(e,t){return new WebSocket(f(e,t))},arguments)}function nn(){return i(function(){return new AbortController},arguments)}function _n(){return new Error}function rn(){return new Map}function on(e,t){return new Error(f(e,t))}function cn(e,t){try{var n={a:e,b:t},_=(c,s)=>{const u=n.a;n.a=0;try{return he(u,n.b,c,s)}finally{n.a=u;}};return new Promise(_)}finally{n.a=n.b=0;}}function sn(e,t){return new Uint8Array(y(e,t))}function an(e,t){return new Function(f(e,t))}function un(e,t,n){return new Uint8Array(e,t>>>0,n>>>0)}function fn(e){return new Uint8Array(e>>>0)}function bn(){return i(function(e,t,n){return new Request(f(e,t),n)},arguments)}function dn(){return i(function(e,t,n){return new WebSocket(f(e,t),n)},arguments)}function gn(e){return e.next}function ln(){return i(function(e){return e.next()},arguments)}function wn(e){return e.node}function yn(e){return e.now()}function pn(){return Date.now()}function mn(e){return e.performance}function hn(e){return e.process}function vn(e,t,n){Uint8Array.prototype.set.call(y(e,t),n);}function kn(e,t){return e.push(t)}function Sn(e){return e.queueMicrotask}function Fn(e){queueMicrotask(e);}function En(){return i(function(e,t){e.randomFillSync(t);},arguments)}function In(e){return e.read()}function Rn(e){return e.readyState}function Mn(e,t){const n=t.reason,_=g(n,r.__wbindgen_malloc,r.__wbindgen_realloc),o=d;a().setInt32(e+4,o,true),a().setInt32(e+0,_,true);}function An(e){e.releaseLock();}function On(){return i(function(e,t,n,_){e.removeEventListener(f(t,n),_);},arguments)}function Tn(){return i(function(){return module.require},arguments)}function Cn(e){return Promise.resolve(e)}function Ln(){return i(function(e,t){e.respond(t>>>0);},arguments)}function zn(){return i(function(e,t,n){e.send(f(t,n));},arguments)}function jn(){return i(function(e,t,n){e.send(y(t,n));},arguments)}function xn(e,t){return setTimeout(e,t)}function Bn(){return i(function(e,t,n){return e.setTimeout(t,n)},arguments)}function Un(e,t,n){e.set(y(t,n));}function qn(e,t,n){e[t]=n;}function Vn(e,t,n){e[t>>>0]=n;}function Wn(e,t){e.binaryType=ve[t];}function $n(e,t){e.body=t;}function Dn(e,t){e.cache=Se[t];}function Pn(e,t){e.credentials=Fe[t];}function Nn(e,t,n){return e.set(t,n)}function Jn(e,t){e.handleEvent=t;}function Gn(e,t){e.headers=t;}function Hn(e,t,n){e.method=f(t,n);}function Kn(e,t){e.mode=Ee[t];}function Xn(e,t){e.onclose=t;}function Yn(e,t){e.onerror=t;}function Qn(e,t){e.onmessage=t;}function Zn(e,t){e.onopen=t;}function e_(e,t){e.signal=t;}function t_(e){return e.signal}function n_(e,t){const n=t.stack,_=g(n,r.__wbindgen_malloc,r.__wbindgen_realloc),o=d;a().setInt32(e+4,o,true),a().setInt32(e+0,_,true);}function __(){const e=typeof global>"u"?null:global;return b(e)?0:l(e)}function r_(){const e=typeof globalThis>"u"?null:globalThis;return b(e)?0:l(e)}function o_(){const e=typeof self>"u"?null:self;return b(e)?0:l(e)}function c_(){const e=typeof window>"u"?null:window;return b(e)?0:l(e)}function i_(e){return e.status}function s_(){return i(function(e){return JSON.stringify(e)},arguments)}function a_(e,t,n){return e.subarray(t>>>0,n>>>0)}function u_(e,t,n){return e.then(t,n)}function f_(e,t){return e.then(t)}function b_(e,t){const n=t.url,_=g(n,r.__wbindgen_malloc,r.__wbindgen_realloc),o=d;a().setInt32(e+4,o,true),a().setInt32(e+0,_,true);}function d_(e,t){const n=t.url,_=g(n,r.__wbindgen_malloc,r.__wbindgen_realloc),o=d;a().setInt32(e+4,o,true),a().setInt32(e+0,_,true);}function g_(e){return e.value}function l_(e){return e.versions}function w_(e){const t=e.view;return b(t)?0:l(t)}function y_(e){console.warn(e);}function p_(e){return e.wasClean}function m_(e,t){return f(e,t)}function h_(e,t){return m(e,t,r.wasm_bindgen_91ae6b94752e5b1f___closure__destroy___dyn_core_eda1fd0e4a34c130___ops__function__FnMut_____Output_______,le)}function v_(e){return BigInt.asUintN(64,e)}function k_(e,t){return ue(e,t,r.wasm_bindgen_91ae6b94752e5b1f___closure__destroy___dyn_core_eda1fd0e4a34c130___ops__function__Fn_____Output_______,we)}function S_(e,t){return m(e,t,r.wasm_bindgen_91ae6b94752e5b1f___closure__destroy___dyn_core_eda1fd0e4a34c130___ops__function__FnMut__wasm_bindgen_91ae6b94752e5b1f___JsValue____Output_______,pe)}function F_(e){return e}function E_(e,t){return m(e,t,r.wasm_bindgen_91ae6b94752e5b1f___closure__destroy___dyn_core_eda1fd0e4a34c130___ops__function__FnMut__web_sys_d62371c9efa9c7d3___features__gen_CloseEvent__CloseEvent____Output_______,de)}function I_(e,t){return m(e,t,r.wasm_bindgen_91ae6b94752e5b1f___closure__destroy___dyn_core_eda1fd0e4a34c130___ops__function__FnMut_____Output________1_,ye)}function R_(e,t){return m(e,t,r.wasm_bindgen_91ae6b94752e5b1f___closure__destroy___dyn_core_eda1fd0e4a34c130___ops__function__FnMut__web_sys_d62371c9efa9c7d3___features__gen_MessageEvent__MessageEvent____Output_______,me)}function M_(e,t){return y(e,t)}function A_(e){return e}function O_(e,t){return m(e,t,r.wasm_bindgen_91ae6b94752e5b1f___closure__destroy___dyn_core_eda1fd0e4a34c130___ops__function__FnMut_____Output________2_,ge)}function T_(){const e=r.__wbindgen_externrefs,t=e.grow(4);e.set(0,void 0),e.set(t+0,void 0),e.set(t+1,null),e.set(t+2,true),e.set(t+3,false);}const C_=Object.freeze(Object.defineProperty({__proto__:null,Connection:h,IntoUnderlyingByteSource:q,IntoUnderlyingSink:V,IntoUnderlyingSource:W,Network:z,Networking:v,Receiver:k,Sender:S,__wbg_Error_52673b7de5a0ca89:Oe,__wbg_Number_2d1dcfcf4ec51736:Te,__wbg_String_8f0eb39a4a4c2f66:Ce,__wbg___wbindgen_bigint_get_as_i64_6e32f5e6aff02e1d:Le,__wbg___wbindgen_boolean_get_dea25b33882b895b:ze,__wbg___wbindgen_debug_string_adfb662ae34724b6:je,__wbg___wbindgen_in_0d3e1e8f0c669317:xe,__wbg___wbindgen_is_bigint_0e1a2e3f55cfae27:Be,__wbg___wbindgen_is_function_8d400b8b1af978cd:Ue,__wbg___wbindgen_is_object_ce774f3490692386:qe,__wbg___wbindgen_is_string_704ef9c8fc131030:Ve,__wbg___wbindgen_is_undefined_f6b95eab589e0269:We,__wbg___wbindgen_jsval_eq_b6101cc9cef1fe36:$e,__wbg___wbindgen_jsval_loose_eq_766057600fdd1b0d:De,__wbg___wbindgen_number_get_9619185a74197f95:Pe,__wbg___wbindgen_string_get_a2a31e16edf96e42:Ne,__wbg___wbindgen_throw_dd24417ed36fc46e:Je,__wbg__wbg_cb_unref_87dfb5aaa0cbcea7:Ge,__wbg_abort_07646c894ebbf2bd:He,__wbg_abort_399ecbcfd6ef3c8e:Ke,__wbg_addEventListener_e792423147a80626:Xe,__wbg_append_c5cbdf46455cc776:Ye,__wbg_arrayBuffer_c04af4fce566092d:Qe,__wbg_body_947b901c33f7fe32:Ze,__wbg_buffer_6cb2fecb1f253d71:et,__wbg_byobRequest_f8e3517f5f8ad284:tt,__wbg_byteLength_faa9938885bdeee6:nt,__wbg_byteOffset_3868b6a19ba01dea:_t,__wbg_call_3020136f7a2d6e44:rt,__wbg_call_abb4ff46ce38be40:ot,__wbg_cancel_a65cf45dca50ba4c:ct,__wbg_catch_b9db41d97d42bd02:it,__wbg_clearTimeout_42d9ccd50822fd3a:st,__wbg_clearTimeout_f7a6c75a3d228439:at,__wbg_close_0af5661bf3d335f2:ut,__wbg_close_1db3952de1b5b1cf:ft,__wbg_close_3ec111e7b23d94d8:bt,__wbg_code_85a811fe6ca962be:dt,__wbg_code_c2a85f2863ec11b3:gt,__wbg_connection_new:lt,__wbg_crypto_574e78ad8b13b65f:wt,__wbg_data_8bf4ae669a78a688:yt,__wbg_debug_9d0c87ddda3dc485:pt,__wbg_done_62ea16af4ce34b24:mt,__wbg_enqueue_a7e6b1ee87963aad:ht,__wbg_entries_83c79938054e065f:vt,__wbg_error_7534b8e9a36f1ab4:kt,__wbg_error_7bc7d576a6aaf855:St,__wbg_fetch_6bbc32f991730587:Ft,__wbg_fetch_90447c28cc0b095e:Et,__wbg_getRandomValues_1c61fac11405ffdc:It,__wbg_getRandomValues_b8f5dbd5f3995a9e:Rt,__wbg_getReader_48e00749fe3f6089:Mt,__wbg_get_6b7bd52aca3f9671:At,__wbg_get_af9dab7e9603ea93:Ot,__wbg_get_done_f98a6e62c4e18fb9:Tt,__wbg_get_value_63e39884ef11812e:Ct,__wbg_get_with_ref_key_1dc361bd10053bfe:Lt,__wbg_has_0e670569d65d3a45:zt,__wbg_headers_654c30e1bcccc552:jt,__wbg_info_ce6bcc489c22f6f0:xt,__wbg_instanceof_ArrayBuffer_f3320d2419cd0355:Bt,__wbg_instanceof_Blob_e9c51ce33a4b6181:Ut,__wbg_instanceof_Map_084be8da74364158:qt,__wbg_instanceof_Response_cd74d1c2ac92cb0b:Vt,__wbg_instanceof_Uint8Array_da54ccc9d3e09434:Wt,__wbg_isArray_51fd9e6422c0a395:$t,__wbg_isSafeInteger_ae7d3f054d55fa16:Dt,__wbg_iterator_27b7c8b35ab3e86b:Pt,__wbg_length_22ac23eaec9d8053:Nt,__wbg_length_d45040a40c570362:Jt,__wbg_log_1d990106d99dacb7:Gt,__wbg_message_a4e9a39ee8f92b17:Ht,__wbg_msCrypto_a61aeb35a24c1329:Kt,__wbg_networking_new:Xt,__wbg_new_1ba21ce319a06297:Yt,__wbg_new_25f239778d6112b9:Qt,__wbg_new_3c79b3bb1b32b7d3:Zt,__wbg_new_6421f6084cc5bc5a:en,__wbg_new_7c30d1f874652e62:tn,__wbg_new_881a222c65f168fc:nn,__wbg_new_8a6f238a6ece86ea:_n,__wbg_new_b546ae120718850e:rn,__wbg_new_df1173567d5ff028:on,__wbg_new_ff12d2b041fb48f1:cn,__wbg_new_from_slice_f9c22b9153b26992:sn,__wbg_new_no_args_cb138f77cf6151ee:an,__wbg_new_with_byte_offset_and_length_d85c3da1fd8df149:un,__wbg_new_with_length_aa5eaf41d35235e5:fn,__wbg_new_with_str_and_init_c5748f76f5108934:bn,__wbg_new_with_str_sequence_073466a4a5387941:dn,__wbg_next_138a17bbf04e926c:gn,__wbg_next_3cfe5c0fe2a4cc53:ln,__wbg_node_905d3e251edff8a2:wn,__wbg_now_2c95c9de01293173:yn,__wbg_now_69d776cd24f5215b:pn,__wbg_performance_7a3ffd0b17f663ad:mn,__wbg_process_dc0fbacc7c1c06f7:hn,__wbg_prototypesetcall_dfe9b766cdc1f1fd:vn,__wbg_push_7d9be8f38fc13975:kn,__wbg_queueMicrotask_9b549dfce8865860:Sn,__wbg_queueMicrotask_fca69f5bfad613a5:Fn,__wbg_randomFillSync_ac0988aba3254290:En,__wbg_read_39c4b35efcd03c25:In,__wbg_readyState_9d0976dcad561aa9:Rn,__wbg_reason_d4eb9e40592438c2:Mn,__wbg_releaseLock_a5912f590b185180:An,__wbg_removeEventListener_54bf92f4a849bd7d:On,__wbg_require_60cc747a6bc5215a:Tn,__wbg_resolve_fd5bfbaa4ce36e1e:Cn,__wbg_respond_9f7fc54636c4a3af:Ln,__wbg_send_7cc36bb628044281:zn,__wbg_send_ea59e150ab5ebe08:jn,__wbg_setTimeout_4ec014681668a581:xn,__wbg_setTimeout_ceaa8eadc563d26e:Bn,__wbg_set_169e13b608078b7b:Un,__wbg_set_3f1d0b984ed272ed:qn,__wbg_set_7df433eea03a5c14:Vn,__wbg_set_binaryType_73e8c75df97825f8:Wn,__wbg_set_body_8e743242d6076a4f:$n,__wbg_set_cache_0e437c7c8e838b9b:Dn,__wbg_set_credentials_55ae7c3c106fd5be:Pn,__wbg_set_efaaf145b9377369:Nn,__wbg_set_handle_event_14baa3949ef6909d:Jn,__wbg_set_headers_5671cf088e114d2b:Gn,__wbg_set_method_76c69e41b3570627:Hn,__wbg_set_mode_611016a6818fc690:Kn,__wbg_set_onclose_032729b3d7ed7a9e:Xn,__wbg_set_onerror_7819daa6af176ddb:Yn,__wbg_set_onmessage_71321d0bed69856c:Qn,__wbg_set_onopen_6d4abedb27ba5656:Zn,__wbg_set_signal_e89be862d0091009:e_,__wbg_set_wasm:J,__wbg_signal_3c14fbdc89694b39:t_,__wbg_stack_0ed75d68575b0f3c:n_,__wbg_static_accessor_GLOBAL_769e6b65d6557335:__,__wbg_static_accessor_GLOBAL_THIS_60cf02db4de8e1c1:r_,__wbg_static_accessor_SELF_08f5a74c69739274:o_,__wbg_static_accessor_WINDOW_a8924b26aa92d024:c_,__wbg_status_9bfc680efca4bdfd:i_,__wbg_stringify_655a6390e1f5eb6b:s_,__wbg_subarray_845f2f5bce7d061a:a_,__wbg_then_429f7caf1026411d:u_,__wbg_then_4f95312d68691235:f_,__wbg_url_b6d11838a4f95198:b_,__wbg_url_df28eef824b04410:d_,__wbg_value_57b7b035e117f7ee:g_,__wbg_versions_c01dfd4722a88165:l_,__wbg_view_788aaf149deefd2f:w_,__wbg_warn_6e567d0d926ff881:y_,__wbg_wasClean_4154a2d59fdb4dd7:p_,__wbindgen_cast_2241b6af4c4b2941:m_,__wbindgen_cast_26a7198d906e0da9:h_,__wbindgen_cast_4625c577ab2ec9ee:v_,__wbindgen_cast_6967318b16109258:k_,__wbindgen_cast_70945345f74a629f:S_,__wbindgen_cast_9ae0607507abb057:F_,__wbindgen_cast_a047a1aec137bbec:E_,__wbindgen_cast_b8e01248d28b3ade:I_,__wbindgen_cast_bbfb5fb734d01b30:R_,__wbindgen_cast_cb9088102bce6b30:M_,__wbindgen_cast_d6cd19b81560fd6e:A_,__wbindgen_cast_f72f381c3f11da0b:O_,__wbindgen_init_externref_table:T_,main:Ae},Symbol.toStringTag,{value:"Module"})),L_=await GM.getResourceUrl("wasm"),z_=await(await fetch(L_)).arrayBuffer(),j_=await WebAssembly.compile(z_),Q=(await WebAssembly.instantiate(j_,{"./yno_vc_bg.js":C_})).exports;J(Q),Q.__wbindgen_start();const x_={new(e,t){const n={element:document.createElement("audio"),buffer:void 0,media:void 0,queue:[]};return n.media=new MediaSource,n.media.addEventListener("sourceopen",()=>{const _=n.media.addSourceBuffer("audio/webm; codecs=opus");n.buffer=_,_.mode="sequence",_.addEventListener("updateend",Z.bind(null,n));}),n.element.src=URL.createObjectURL(n.media),n.element.play().catch(()=>{}),{identify:e,public_key:t.take_public_key(),send:t.take_send(),receive:t.take_receive(),audio:n}}};function Z(e){try{if(!e.queue.length||e.buffer.updating)return;for(;e.queue.length>10;)e.queue.shift();const t=e.queue.shift();t&&e.buffer?.appendBuffer(t);}catch(t){console.log(t);}}const j=await GM.getValue("keys")||{},ee=new Set,te=new Set;for(const e of Object.values(j))te.has(e)?ee.add(e):te.add(e);const $={};for(const[e,t]of Object.entries(j))ee.has(t)||($[e]=t);function ne(e){return $[e]}function _e(e,t){j[e]=t,$[e]=t,GM.setValue("keys",j);}let F;setTimeout(()=>{const e="grayscale(100%) sepia(100%) saturate(1000%) ",t=e+"hue-rotate(-30deg)",n=e+"hue-rotate(100deg)",_=document.createElement("button");_.textContent="ðŸŽ¤",_.className="iconButton toggleButton offToggleButton unselectable",_.style.fontSize="20px",_.style.filter=t,document.getElementById("leftControls").appendChild(_);let o=false;_.addEventListener("click",()=>{o=!o,o?(_.style.filter=n,F?F.start(100):B_()):(_.style.filter=t,F.stop());});},5e3);async function B_(){F=new MediaRecorder(await navigator.mediaDevices.getUserMedia({audio:true}),{mimeType:"audio/webm; codecs=opus",audioBitsPerSecond:6e3}),F.addEventListener("dataavailable",se),F.start(100);}const A=new Set;function U_(){{const e=unsafeWindow.addOrUpdatePlayerListEntry;unsafeWindow.addOrUpdatePlayerListEntry=function(t,n){return (!t||t.id=="playerList")&&!A.has(n.uuid)&&(A.add(n.uuid),ae(n)),e.apply(this,arguments)};}{const e=unsafeWindow.removePlayerListEntry;unsafeWindow.removePlayerListEntry=function(t,n){return (!t||t.id=="playerList")&&A.has(n)&&(A.delete(n),N(n)),e.apply(this,arguments)};}{const e=unsafeWindow.clearPlayerList;unsafeWindow.clearPlayerList=function(t){return (!t||t.id=="playerList")&&A.forEach(n=>N(n)),e.apply(this,arguments)};}}const re=await GM.getValue("secret_key"),x=await new z(re).init();re==null&&GM.setValue("secret_key",x.get_secret_key());const E=x.get_public_key(),w=new Set,q_=setInterval(()=>{unsafeWindow.chatboxAddMessage&&(clearInterval(q_),V_(),W_(),U_());},1e3);function V_(){const e=unsafeWindow.chatInputActionFired;unsafeWindow.chatInputActionFired=function(){const t=document.getElementById("chatInput");return !t.dataset.global&&t.value.trim()=="/voice.join"&&(t.value=`/voice.join:${E}`),e.apply(this,arguments)};}function W_(){const e=unsafeWindow.chatboxAddMessage;unsafeWindow.chatboxAddMessage=function(t,n,_){const o=t.split(":");if(o[0]=="/voice.join"){const c=o[1];c!=E&&(_e(_,c),oe(_,c));}else if(o[0]=="/voice.identify"){const c=o[1];if(c!=E){_e(_,c);const s=[...w].find(u=>u.public_key==c);s?s.player=_:console.warn(`No connection found for ${_}`);}}return e.apply(this,arguments)};}let D=new Set;async function oe(e,t){t!=E&&(D.has(t)||[...w].find(n=>n.player==e||n.public_key==t)||(console.log(`Connecting to ${t}`),D.add(t),x.connect(t).then(n=>{console.log(`Connected to ${t}`),ce(true,n).player=e;}).catch(()=>{console.log(`Failed to connect to ${t}`);}).then(()=>{D.delete(t);})));}(async function(){for(;;)await x.accept().then(ce.bind(null,false)).catch(e=>{console.log("Failed accepting connection: "+e);});})();function ce(e,t){const n=x_.new(e,t);return $_(n),w.add(n),n}function P(e,t){w.delete(e),t&&(t=t.replaceAll("%player%",e?.player||"an unidentified player"),console.log(t));}async function ie(e,t){try{await e.send.send(t);}catch(n){P(e,`Voice disconnected %player% due to send error ${n}`);}}async function $_(e){try{for(;;){const t=await e.receive.read(),n=t.get("type"),_=t.get("data");({Hello(){e.player=ne(e.public_key),e.player||ie(e,{type:"Identify"});},Identify(){if(e.identify!==!0)return P(e,"Voice disconnected %player% due to requesting identification");e.identify=!1,unsafeWindow.sendSessionCommand("say",["/voice.identify:"+E]);},VoiceData(o){console.log("received voice data");const c=new Uint8Array(o),{queue:s,element:u}=e.audio;s.push(c),u.paused&&u.play().catch(()=>{}),Z(e.audio);}}[n]||(()=>{throw `unexpected ${n} packet`}))(_);}}catch(t){P(e,`Voice disconnected %player% due to receive error ${t}`);}}async function se(e){if(!e.data.size)return;const t={type:"VoiceData",data:Array.from(await e.data.bytes())},n=[...w].map(_=>ie(_,t));for(const _ of n)await _;}function ae(e){const t=[...w].find(n=>n.player==e.uuid);if(t)t.expiration&&(clearTimeout(t.expiration),t.expiration=void 0);else {const n=ne(e.uuid);if(!n||n>=E)return;oe(e.uuid,n);}}function N(e){const t=[...w].find(n=>n.player==e);t&&(t.expiration=setTimeout(()=>{w.delete(t);},3e4));}return I.onMicrophoneData=se,I.onPlayerJoin=ae,I.onPlayerLeave=N,Object.defineProperty(I,Symbol.toStringTag,{value:"Module"}),I}))({});

})();