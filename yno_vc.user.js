// ==UserScript==
// @name         YNO Voice Chat
// @version      0.0.2
// @license      MIT OR Apache-2.0
// @source       https://github.com/AcrylonitrileButadieneStyrene/yno-vc
// @supportURL   https://github.com/AcrylonitrileButadieneStyrene/yno-vc/issues
// @downloadURL  https://raw.githubusercontent.com/AcrylonitrileButadieneStyrene/yno-vc/refs/heads/builds/yno_vc.user.js
// @updateURL    https://raw.githubusercontent.com/AcrylonitrileButadieneStyrene/yno-vc/refs/heads/builds/yno_vc.meta.js
// @match        *://ynoproject.net/*
// @resource     wasm  https://raw.githubusercontent.com/AcrylonitrileButadieneStyrene/yno-vc/refs/heads/builds/yno_vc.wasm
// @grant        GM.getResourceUrl
// @grant        GM.getValue
// @grant        GM.setValue
// @grant        unsafeWindow
// ==/UserScript==

(function () {
    'use strict';

    /* This file has been minified to reduce its file size.
     * A readable copy of the code is accessible at the link in the @source tag above.
     */
    ((async function(p){class m{static __wrap(t){t=t>>>0;const n=Object.create(m.prototype);return n.__wbg_ptr=t,ee.register(n,n.__wbg_ptr,n),n}__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,ee.unregister(this),t}free(){const t=this.__destroy_into_raw();r.__wbg_connection_free(t,0);}take_public_key(){const t=r.connection_take_public_key(this.__wbg_ptr);let n;return t[0]!==0&&(n=f(t[0],t[1]).slice(),r.__wbindgen_free(t[0],t[1]*1,1)),n}take_receive(){const t=r.connection_take_receive(this.__wbg_ptr);return t===0?void 0:v.__wrap(t)}take_send(){const t=r.connection_take_send(this.__wbg_ptr);return t===0?void 0:k.__wrap(t)}}Symbol.dispose&&(m.prototype[Symbol.dispose]=m.prototype.free);class P{__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,V_.unregister(this),t}free(){const t=this.__destroy_into_raw();r.__wbg_intounderlyingbytesource_free(t,0);}get autoAllocateChunkSize(){return r.intounderlyingbytesource_autoAllocateChunkSize(this.__wbg_ptr)>>>0}cancel(){const t=this.__destroy_into_raw();r.intounderlyingbytesource_cancel(t);}pull(t){return r.intounderlyingbytesource_pull(this.__wbg_ptr,t)}start(t){r.intounderlyingbytesource_start(this.__wbg_ptr,t);}get type(){const t=r.intounderlyingbytesource_type(this.__wbg_ptr);return B_[t]}}Symbol.dispose&&(P.prototype[Symbol.dispose]=P.prototype.free);class D{__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,P_.unregister(this),t}free(){const t=this.__destroy_into_raw();r.__wbg_intounderlyingsink_free(t,0);}abort(t){const n=this.__destroy_into_raw();return r.intounderlyingsink_abort(n,t)}close(){const t=this.__destroy_into_raw();return r.intounderlyingsink_close(t)}write(t){return r.intounderlyingsink_write(this.__wbg_ptr,t)}}Symbol.dispose&&(D.prototype[Symbol.dispose]=D.prototype.free);class W{__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,D_.unregister(this),t}free(){const t=this.__destroy_into_raw();r.__wbg_intounderlyingsource_free(t,0);}cancel(){const t=this.__destroy_into_raw();r.intounderlyingsource_cancel(t);}pull(t){return r.intounderlyingsource_pull(this.__wbg_ptr,t)}}Symbol.dispose&&(W.prototype[Symbol.dispose]=W.prototype.free);class z{__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,te.unregister(this),t}free(){const t=this.__destroy_into_raw();r.__wbg_network_free(t,0);}init(){const t=this.__destroy_into_raw();return r.network_init(t)}constructor(t){var n=b(t)?0:l(t,r.__wbindgen_malloc,r.__wbindgen_realloc),_=d;const o=r.network_new(n,_);return this.__wbg_ptr=o>>>0,te.register(this,this.__wbg_ptr,this),this}}Symbol.dispose&&(z.prototype[Symbol.dispose]=z.prototype.free);class h{static __wrap(t){t=t>>>0;const n=Object.create(h.prototype);return n.__wbg_ptr=t,ne.register(n,n.__wbg_ptr,n),n}__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,ne.unregister(this),t}free(){const t=this.__destroy_into_raw();r.__wbg_networking_free(t,0);}accept(){return r.networking_accept(this.__wbg_ptr)}connect(t){const n=l(t,r.__wbindgen_malloc,r.__wbindgen_realloc),_=d;return r.networking_connect(this.__wbg_ptr,n,_)}get_public_key(){let t,n;try{const _=r.networking_get_public_key(this.__wbg_ptr);return t=_[0],n=_[1],f(_[0],_[1])}finally{r.__wbindgen_free(t,n,1);}}get_secret_key(){let t,n;try{const _=r.networking_get_secret_key(this.__wbg_ptr);return t=_[0],n=_[1],f(_[0],_[1])}finally{r.__wbindgen_free(t,n,1);}}}Symbol.dispose&&(h.prototype[Symbol.dispose]=h.prototype.free);class v{static __wrap(t){t=t>>>0;const n=Object.create(v.prototype);return n.__wbg_ptr=t,_e.register(n,n.__wbg_ptr,n),n}__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,_e.unregister(this),t}free(){const t=this.__destroy_into_raw();r.__wbg_receiver_free(t,0);}read(){return r.receiver_read(this.__wbg_ptr)}}Symbol.dispose&&(v.prototype[Symbol.dispose]=v.prototype.free);class k{static __wrap(t){t=t>>>0;const n=Object.create(k.prototype);return n.__wbg_ptr=t,re.register(n,n.__wbg_ptr,n),n}__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,re.unregister(this),t}free(){const t=this.__destroy_into_raw();r.__wbg_sender_free(t,0);}send(t){return r.sender_send(this.__wbg_ptr,t)}}Symbol.dispose&&(k.prototype[Symbol.dispose]=k.prototype.free);class L{__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,oe.unregister(this),t}free(){const t=this.__destroy_into_raw();r.__wbg_state_free(t,0);}init(){r.state_init(this.__wbg_ptr);}constructor(){const t=r.state_new();return this.__wbg_ptr=t>>>0,oe.register(this,this.__wbg_ptr,this),this}on_player_join(t){const n=l(t,r.__wbindgen_malloc,r.__wbindgen_realloc),_=d;return r.state_on_player_join(this.__wbg_ptr,n,_)!==0}on_player_leave(t){const n=l(t,r.__wbindgen_malloc,r.__wbindgen_realloc),_=d;return r.state_on_player_leave(this.__wbg_ptr,n,_)!==0}on_players_cleared(){r.state_on_players_cleared(this.__wbg_ptr);}}Symbol.dispose&&(L.prototype[Symbol.dispose]=L.prototype.free);function Ce(){r.main();}function Ie(e,t){return Error(f(e,t))}function Re(e){return Number(e)}function Te(e,t){const n=String(t),_=l(n,r.__wbindgen_malloc,r.__wbindgen_realloc),o=d;a().setInt32(e+4,o,true),a().setInt32(e+0,_,true);}function Me(e,t){const n=t,_=typeof n=="bigint"?n:void 0;a().setBigInt64(e+8,b(_)?BigInt(0):_,true),a().setInt32(e+0,!b(_),true);}function Ae(e){const t=e,n=typeof t=="boolean"?t:void 0;return b(n)?16777215:n?1:0}function xe(e,t){const n=$(t),_=l(n,r.__wbindgen_malloc,r.__wbindgen_realloc),o=d;a().setInt32(e+4,o,true),a().setInt32(e+0,_,true);}function Oe(e,t){return e in t}function ze(e){return typeof e=="bigint"}function Le(e){return typeof e=="function"}function Be(e){const t=e;return typeof t=="object"&&t!==null}function je(e){return typeof e=="string"}function Ue(e){return e===void 0}function qe(e,t){return e===t}function Ve(e,t){return e==t}function Pe(e,t){const n=t,_=typeof n=="number"?n:void 0;a().setFloat64(e+8,b(_)?0:_,true),a().setInt32(e+0,!b(_),true);}function De(e,t){const n=t,_=typeof n=="string"?n:void 0;var o=b(_)?0:l(_,r.__wbindgen_malloc,r.__wbindgen_realloc),c=d;a().setInt32(e+4,c,true),a().setInt32(e+0,o,true);}function We(e,t){throw new Error(f(e,t))}function $e(e){e._wbg_cb_unref();}function Ne(e){e.abort();}function Je(e,t){e.abort(t);}function Ge(){return s(function(e,t,n,_){e.addEventListener(f(t,n),_);},arguments)}function He(){return s(function(e,t,n,_,o){e.append(f(t,n),f(_,o));},arguments)}function Ke(){return s(function(e){return e.arrayBuffer()},arguments)}function Xe(e){const t=e.body;return b(t)?0:w(t)}function Ye(e){return e.buffer}function Qe(e){const t=e.byobRequest;return b(t)?0:w(t)}function Ze(e){return e.byteLength}function et(e){return e.byteOffset}function tt(){return s(function(e,t){return e.call(t)},arguments)}function nt(){return s(function(e,t,n){return e.call(t,n)},arguments)}function _t(e){return e.cancel()}function rt(e,t){return e.catch(t)}function ot(e){return clearTimeout(e)}function ct(){return s(function(e,t){e.clearTimeout(t);},arguments)}function it(){return s(function(e){e.close();},arguments)}function st(){return s(function(e){e.close();},arguments)}function at(){return s(function(e){e.close();},arguments)}function ut(e){return e.code}function ft(e){return e.code}function bt(e){return m.__wrap(e)}function dt(e){return e.crypto}function lt(e){return e.data}function gt(e){console.debug(e);}function wt(e){return e.done}function yt(){return s(function(e,t){e.enqueue(t);},arguments)}function pt(e){return Object.entries(e)}function mt(e,t){let n,_;try{n=e,_=t,console.error(f(e,t));}finally{r.__wbindgen_free(n,_,1);}}function ht(e){console.error(e);}function vt(e){return fetch(e)}function kt(e,t){return e.fetch(t)}function St(){return s(function(e,t){globalThis.crypto.getRandomValues(S(e,t));},arguments)}function Ft(){return s(function(e,t){e.getRandomValues(t);},arguments)}function Et(){return s(function(e){return e.getReader()},arguments)}function Ct(e,t){return e[t>>>0]}function It(){return s(function(e,t){return Reflect.get(e,t)},arguments)}function Rt(e){const t=e.done;return b(t)?16777215:t?1:0}function Tt(e){return e.value}function Mt(e,t){return e[t]}function At(){return s(function(e,t){return Reflect.has(e,t)},arguments)}function xt(e){return e.headers}function Ot(e){console.info(e);}function zt(e){let t;try{t=e instanceof ArrayBuffer;}catch{t=false;}return t}function Lt(e){let t;try{t=e instanceof Blob;}catch{t=false;}return t}function Bt(e){let t;try{t=e instanceof Map;}catch{t=false;}return t}function jt(e){let t;try{t=e instanceof Response;}catch{t=false;}return t}function Ut(e){let t;try{t=e instanceof Uint8Array;}catch{t=false;}return t}function qt(e){return Array.isArray(e)}function Vt(e){return Number.isSafeInteger(e)}function Pt(){return Symbol.iterator}function Dt(e){return e.length}function Wt(e){return e.length}function $t(e){console.log(e);}function Nt(e,t){const n=t.message,_=l(n,r.__wbindgen_malloc,r.__wbindgen_realloc),o=d;a().setInt32(e+4,o,true),a().setInt32(e+0,_,true);}function Jt(e){return e.msCrypto}function Gt(e){return h.__wrap(e)}function Ht(){return s(function(e,t){return new WebSocket(f(e,t))},arguments)}function Kt(){return new Object}function Xt(){return new Array}function Yt(){return s(function(){return new Headers},arguments)}function Qt(e,t){return new Error(f(e,t))}function Zt(){return new Error}function en(e,t){try{var n={a:e,b:t},_=(c,i)=>{const u=n.a;n.a=0;try{return z_(u,n.b,c,i)}finally{n.a=u;}};return new Promise(_)}finally{n.a=n.b=0;}}function tn(){return s(function(){return new AbortController},arguments)}function nn(){return new Map}function _n(e){return new Uint8Array(e)}function rn(e,t){return new Uint8Array(S(e,t))}function on(e,t){return new Function(f(e,t))}function cn(e,t,n){return new Uint8Array(e,t>>>0,n>>>0)}function sn(e){return new Uint8Array(e>>>0)}function an(){return s(function(e,t,n){return new Request(f(e,t),n)},arguments)}function un(){return s(function(e,t,n){return new WebSocket(f(e,t),n)},arguments)}function fn(){return s(function(e){return e.next()},arguments)}function bn(e){return e.next}function dn(e){return e.node}function ln(e){return e.now()}function gn(){return Date.now()}function wn(e){return e.performance}function yn(e){return e.process}function pn(e,t,n){Uint8Array.prototype.set.call(S(e,t),n);}function mn(e,t){return e.push(t)}function hn(e){return e.queueMicrotask}function vn(e){queueMicrotask(e);}function kn(){return s(function(e,t){e.randomFillSync(t);},arguments)}function Sn(e){return e.read()}function Fn(e){return e.readyState}function En(e,t){const n=t.reason,_=l(n,r.__wbindgen_malloc,r.__wbindgen_realloc),o=d;a().setInt32(e+4,o,true),a().setInt32(e+0,_,true);}function Cn(e){e.releaseLock();}function In(){return s(function(e,t,n,_){e.removeEventListener(f(t,n),_);},arguments)}function Rn(){return s(function(){return module.require},arguments)}function Tn(e){return Promise.resolve(e)}function Mn(){return s(function(e,t){e.respond(t>>>0);},arguments)}function An(){return s(function(e,t,n){e.send(S(t,n));},arguments)}function xn(){return s(function(e,t,n){e.send(f(t,n));},arguments)}function On(){return s(function(e,t,n){return e.setTimeout(t,n)},arguments)}function zn(e,t){return setTimeout(e,t)}function Ln(e,t,n){return e.set(t,n)}function Bn(e,t,n){e[t]=n;}function jn(e,t){e.binaryType=L_[t];}function Un(e,t){e.body=t;}function qn(e,t){e.cache=j_[t];}function Vn(e,t,n){e.set(S(t,n));}function Pn(e,t){e.credentials=U_[t];}function Dn(e,t,n){e[t>>>0]=n;}function Wn(e,t){e.handleEvent=t;}function $n(e,t){e.headers=t;}function Nn(e,t,n){e.method=f(t,n);}function Jn(e,t){e.mode=q_[t];}function Gn(e,t){e.onclose=t;}function Hn(e,t){e.onerror=t;}function Kn(e,t){e.onmessage=t;}function Xn(e,t){e.onopen=t;}function Yn(e,t){e.signal=t;}function Qn(e){return e.signal}function Zn(e,t){const n=t.stack,_=l(n,r.__wbindgen_malloc,r.__wbindgen_realloc),o=d;a().setInt32(e+4,o,true),a().setInt32(e+0,_,true);}function e_(){const e=typeof global>"u"?null:global;return b(e)?0:w(e)}function t_(){const e=typeof globalThis>"u"?null:globalThis;return b(e)?0:w(e)}function n_(){const e=typeof self>"u"?null:self;return b(e)?0:w(e)}function __(){const e=typeof window>"u"?null:window;return b(e)?0:w(e)}function r_(e){return e.status}function o_(){return s(function(e){return JSON.stringify(e)},arguments)}function c_(e,t,n){return e.subarray(t>>>0,n>>>0)}function i_(e,t,n){return e.then(t,n)}function s_(e,t){return e.then(t)}function a_(e,t){const n=t.url,_=l(n,r.__wbindgen_malloc,r.__wbindgen_realloc),o=d;a().setInt32(e+4,o,true),a().setInt32(e+0,_,true);}function u_(e,t){const n=t.url,_=l(n,r.__wbindgen_malloc,r.__wbindgen_realloc),o=d;a().setInt32(e+4,o,true),a().setInt32(e+0,_,true);}function f_(e){return e.value}function b_(e){return e.versions}function d_(e){const t=e.view;return b(t)?0:w(t)}function l_(e){console.warn(e);}function g_(e){return e.wasClean}function w_(e,t){return T(e,t,r.wasm_bindgen_52537c511826774c___closure__destroy___dyn_core_42533880c38c7468___ops__function__FnMut__web_sys_92f97b171b927b1d___features__gen_CloseEvent__CloseEvent____Output_______,A_)}function y_(e,t){return W_(e,t,r.wasm_bindgen_52537c511826774c___closure__destroy___dyn_core_42533880c38c7468___ops__function__Fn_____Output_______,R_)}function p_(e,t){return T(e,t,r.wasm_bindgen_52537c511826774c___closure__destroy___dyn_core_42533880c38c7468___ops__function__FnMut__web_sys_92f97b171b927b1d___features__gen_MessageEvent__MessageEvent____Output_______,x_)}function m_(e,t){return T(e,t,r.wasm_bindgen_52537c511826774c___closure__destroy___dyn_core_42533880c38c7468___ops__function__FnMut_____Output_______,T_)}function h_(e,t){return T(e,t,r.wasm_bindgen_52537c511826774c___closure__destroy___dyn_core_42533880c38c7468___ops__function__FnMut_____Output________1_,M_)}function v_(e,t){return T(e,t,r.wasm_bindgen_52537c511826774c___closure__destroy___dyn_core_42533880c38c7468___ops__function__FnMut__wasm_bindgen_52537c511826774c___JsValue____Output_______,O_)}function k_(e){return e}function S_(e){return e}function F_(e,t){return S(e,t)}function E_(e,t){return f(e,t)}function C_(e){return BigInt.asUintN(64,e)}function I_(){const e=r.__wbindgen_externrefs,t=e.grow(4);e.set(0,void 0),e.set(t+0,void 0),e.set(t+1,null),e.set(t+2,true),e.set(t+3,false);}function R_(e,t){r.wasm_bindgen_52537c511826774c___convert__closures_____invoke______(e,t);}function T_(e,t){r.wasm_bindgen_52537c511826774c___convert__closures_____invoke_______1_(e,t);}function M_(e,t){r.wasm_bindgen_52537c511826774c___convert__closures_____invoke_______2_(e,t);}function A_(e,t,n){r.wasm_bindgen_52537c511826774c___convert__closures_____invoke___web_sys_92f97b171b927b1d___features__gen_CloseEvent__CloseEvent_____(e,t,n);}function x_(e,t,n){r.wasm_bindgen_52537c511826774c___convert__closures_____invoke___web_sys_92f97b171b927b1d___features__gen_MessageEvent__MessageEvent_____(e,t,n);}function O_(e,t,n){r.wasm_bindgen_52537c511826774c___convert__closures_____invoke___wasm_bindgen_52537c511826774c___JsValue_____(e,t,n);}function z_(e,t,n,_){r.wasm_bindgen_52537c511826774c___convert__closures_____invoke___wasm_bindgen_52537c511826774c___JsValue__wasm_bindgen_52537c511826774c___JsValue_____(e,t,n,_);}const L_=["blob","arraybuffer"],B_=["bytes"],j_=["default","no-store","reload","no-cache","force-cache","only-if-cached"],U_=["omit","same-origin","include"],q_=["same-origin","no-cors","cors","navigate"],ee=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>r.__wbg_connection_free(e>>>0,1)),V_=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>r.__wbg_intounderlyingbytesource_free(e>>>0,1)),P_=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>r.__wbg_intounderlyingsink_free(e>>>0,1)),D_=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>r.__wbg_intounderlyingsource_free(e>>>0,1)),te=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>r.__wbg_network_free(e>>>0,1)),ne=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>r.__wbg_networking_free(e>>>0,1)),_e=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>r.__wbg_receiver_free(e>>>0,1)),re=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>r.__wbg_sender_free(e>>>0,1)),oe=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>r.__wbg_state_free(e>>>0,1));function w(e){const t=r.__externref_table_alloc();return r.__wbindgen_externrefs.set(t,e),t}const B=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>e.dtor(e.a,e.b));function $(e){const t=typeof e;if(t=="number"||t=="boolean"||e==null)return `${e}`;if(t=="string")return `"${e}"`;if(t=="symbol"){const o=e.description;return o==null?"Symbol":`Symbol(${o})`}if(t=="function"){const o=e.name;return typeof o=="string"&&o.length>0?`Function(${o})`:"Function"}if(Array.isArray(e)){const o=e.length;let c="[";o>0&&(c+=$(e[0]));for(let i=1;i<o;i++)c+=", "+$(e[i]);return c+="]",c}const n=/\[object ([^\]]+)\]/.exec(toString.call(e));let _;if(n&&n.length>1)_=n[1];else return toString.call(e);if(_=="Object")try{return "Object("+JSON.stringify(e)+")"}catch{return "Object"}return e instanceof Error?`${e.name}: ${e.message}
${e.stack}`:_}function S(e,t){return e=e>>>0,R().subarray(e/1,e/1+t)}let F=null;function a(){return (F===null||F.buffer.detached===true||F.buffer.detached===void 0&&F.buffer!==r.memory.buffer)&&(F=new DataView(r.memory.buffer)),F}function f(e,t){return e=e>>>0,N_(e,t)}let j=null;function R(){return (j===null||j.byteLength===0)&&(j=new Uint8Array(r.memory.buffer)),j}function s(e,t){try{return e.apply(this,t)}catch(n){const _=w(n);r.__wbindgen_exn_store(_);}}function b(e){return e==null}function W_(e,t,n,_){const o={a:e,b:t,cnt:1,dtor:n},c=(...i)=>{o.cnt++;try{return _(o.a,o.b,...i)}finally{c._wbg_cb_unref();}};return c._wbg_cb_unref=()=>{--o.cnt===0&&(o.dtor(o.a,o.b),o.a=0,B.unregister(o));},B.register(c,o,o),c}function T(e,t,n,_){const o={a:e,b:t,cnt:1,dtor:n},c=(...i)=>{o.cnt++;const u=o.a;o.a=0;try{return _(u,o.b,...i)}finally{o.a=u,c._wbg_cb_unref();}};return c._wbg_cb_unref=()=>{--o.cnt===0&&(o.dtor(o.a,o.b),o.a=0,B.unregister(o));},B.register(c,o,o),c}function l(e,t,n){if(n===void 0){const u=M.encode(e),O=t(u.length,1)>>>0;return R().subarray(O,O+u.length).set(u),d=u.length,O}let _=e.length,o=t(_,1)>>>0;const c=R();let i=0;for(;i<_;i++){const u=e.charCodeAt(i);if(u>127)break;c[o+i]=u;}if(i!==_){i!==0&&(e=e.slice(i)),o=n(o,_,_=i+e.length*3,1)>>>0;const u=R().subarray(o+i,o+_),O=M.encodeInto(e,u);i+=O.written,o=n(o,_,i,1)>>>0;}return d=i,o}let U=new TextDecoder("utf-8",{ignoreBOM:true,fatal:true});U.decode();const $_=2146435072;let N=0;function N_(e,t){return N+=t,N>=$_&&(U=new TextDecoder("utf-8",{ignoreBOM:true,fatal:true}),U.decode(),N=t),U.decode(R().subarray(e,e+t))}const M=new TextEncoder;"encodeInto"in M||(M.encodeInto=function(e,t){const n=M.encode(e);return t.set(n),{read:e.length,written:n.length}});let d=0,r;function ce(e){r=e;}const J_=Object.freeze(Object.defineProperty({__proto__:null,Connection:m,IntoUnderlyingByteSource:P,IntoUnderlyingSink:D,IntoUnderlyingSource:W,Network:z,Networking:h,Receiver:v,Sender:k,State:L,__wbg_Error_8c4e43fe74559d73:Ie,__wbg_Number_04624de7d0e8332d:Re,__wbg_String_8f0eb39a4a4c2f66:Te,__wbg___wbindgen_bigint_get_as_i64_8fcf4ce7f1ca72a2:Me,__wbg___wbindgen_boolean_get_bbbb1c18aa2f5e25:Ae,__wbg___wbindgen_debug_string_0bc8482c6e3508ae:xe,__wbg___wbindgen_in_47fa6863be6f2f25:Oe,__wbg___wbindgen_is_bigint_31b12575b56f32fc:ze,__wbg___wbindgen_is_function_0095a73b8b156f76:Le,__wbg___wbindgen_is_object_5ae8e5880f2c1fbd:Be,__wbg___wbindgen_is_string_cd444516edc5b180:je,__wbg___wbindgen_is_undefined_9e4d92534c42d778:Ue,__wbg___wbindgen_jsval_eq_11888390b0186270:qe,__wbg___wbindgen_jsval_loose_eq_9dd77d8cd6671811:Ve,__wbg___wbindgen_number_get_8ff4255516ccad3e:Pe,__wbg___wbindgen_string_get_72fb696202c56729:De,__wbg___wbindgen_throw_be289d5034ed271b:We,__wbg__wbg_cb_unref_d9b87ff7982e3b21:$e,__wbg_abort_2f0584e03e8e3950:Ne,__wbg_abort_d549b92d3c665de1:Je,__wbg_addEventListener_14e74488d3142fa7:Ge,__wbg_append_a992ccc37aa62dc4:He,__wbg_arrayBuffer_bb54076166006c39:Ke,__wbg_body_3a0b4437dadea6bf:Xe,__wbg_buffer_26d0910f3a5bc899:Ye,__wbg_byobRequest_80e594e6da4e1af7:Qe,__wbg_byteLength_3417f266f4bf562a:Ze,__wbg_byteOffset_f88547ca47c86358:et,__wbg_call_389efe28435a9388:tt,__wbg_call_4708e0c13bdc8e95:nt,__wbg_cancel_2c0a0a251ff6b2b7:_t,__wbg_catch_c1f8c7623b458214:rt,__wbg_clearTimeout_42d9ccd50822fd3a:ot,__wbg_clearTimeout_5e42188b495715bb:ct,__wbg_close_06dfa0a815b9d71f:it,__wbg_close_1d08eaf57ed325c0:st,__wbg_close_a79afee31de55b36:at,__wbg_code_35e4ec59fbc7d427:ut,__wbg_code_a552f1e91eda69b7:ft,__wbg_connection_new:bt,__wbg_crypto_86f2631e91b51511:dt,__wbg_data_5330da50312d0bc1:lt,__wbg_debug_a4099fa12db6cd61:gt,__wbg_done_57b39ecd9addfe81:wt,__wbg_enqueue_2c63f2044f257c3e:yt,__wbg_entries_58c7934c745daac7:pt,__wbg_error_7534b8e9a36f1ab4:mt,__wbg_error_9a7fe3f932034cde:ht,__wbg_fetch_6bbc32f991730587:vt,__wbg_fetch_afb6a4b6cacf876d:kt,__wbg_getRandomValues_1c61fac11405ffdc:St,__wbg_getRandomValues_b3f15fcbfabb0f8b:Ft,__wbg_getReader_48e00749fe3f6089:Et,__wbg_get_9b94d73e6221f75c:Ct,__wbg_get_b3ed3ad4be2bc8ac:It,__wbg_get_done_1ad1c16537f444c6:Rt,__wbg_get_value_6b77a1b7b90c9200:Tt,__wbg_get_with_ref_key_1dc361bd10053bfe:Mt,__wbg_has_d4e53238966c12b6:At,__wbg_headers_59a2938db9f80985:xt,__wbg_info_148d043840582012:Ot,__wbg_instanceof_ArrayBuffer_c367199e2fa2aa04:zt,__wbg_instanceof_Blob_ce92a9ddd729a84a:Lt,__wbg_instanceof_Map_53af74335dec57f4:Bt,__wbg_instanceof_Response_ee1d54d79ae41977:jt,__wbg_instanceof_Uint8Array_9b9075935c74707c:Ut,__wbg_isArray_d314bb98fcf08331:qt,__wbg_isSafeInteger_bfbc7332a9768d2a:Vt,__wbg_iterator_6ff6560ca1568e55:Pt,__wbg_length_32ed9a279acd054c:Dt,__wbg_length_35a7bace40f36eac:Wt,__wbg_log_6b5ca2e6124b2808:$t,__wbg_message_0b2b0298a231b0d4:Nt,__wbg_msCrypto_d562bbe83e0d4b91:Jt,__wbg_networking_new:Gt,__wbg_new_057993d5b5e07835:Ht,__wbg_new_361308b2356cecd0:Kt,__wbg_new_3eb36ae241fe6f44:Xt,__wbg_new_64284bd487f9d239:Yt,__wbg_new_72b49615380db768:Qt,__wbg_new_8a6f238a6ece86ea:Zt,__wbg_new_b5d9e2fb389fef91:en,__wbg_new_b949e7f56150a5d1:tn,__wbg_new_dca287b076112a51:nn,__wbg_new_dd2b680c8bf6ae29:_n,__wbg_new_from_slice_a3d2629dc1826784:rn,__wbg_new_no_args_1c7c842f08d00ebb:on,__wbg_new_with_byte_offset_and_length_aa261d9c9da49eb1:cn,__wbg_new_with_length_a2c39cbe88fd8ff1:sn,__wbg_new_with_str_and_init_a61cbc6bdef21614:an,__wbg_new_with_str_sequence_b67b3919b8b11238:un,__wbg_next_3482f54c49e8af19:fn,__wbg_next_418f80d8f5303233:bn,__wbg_node_e1f24f89a7336c2e:dn,__wbg_now_2c95c9de01293173:ln,__wbg_now_a3af9a2f4bbaa4d1:gn,__wbg_performance_7a3ffd0b17f663ad:wn,__wbg_process_3975fd6c72f520aa:yn,__wbg_prototypesetcall_bdcdcc5842e4d77d:pn,__wbg_push_8ffdcb2063340ba5:mn,__wbg_queueMicrotask_0aa0a927f78f5d98:hn,__wbg_queueMicrotask_5bb536982f78a56f:vn,__wbg_randomFillSync_f8c153b79f285817:kn,__wbg_read_68fd377df67e19b0:Sn,__wbg_readyState_1bb73ec7b8a54656:Fn,__wbg_reason_35fce8e55dd90f31:En,__wbg_releaseLock_aa5846c2494b3032:Cn,__wbg_removeEventListener_34a7e78acf851dd7:In,__wbg_require_b74f47fc2d022fd6:Rn,__wbg_resolve_002c4b7d9d8f6b64:Tn,__wbg_respond_bf6ab10399ca8722:Mn,__wbg_send_542f95dea2df7994:An,__wbg_send_bc0336a1b5ce4fb7:xn,__wbg_setTimeout_2b111259203a2623:On,__wbg_setTimeout_4ec014681668a581:zn,__wbg_set_1eb0999cf5d27fc8:Ln,__wbg_set_3f1d0b984ed272ed:Bn,__wbg_set_binaryType_5bbf62e9f705dc1a:jn,__wbg_set_body_9a7e00afe3cfe244:Un,__wbg_set_cache_315a3ed773a41543:qn,__wbg_set_cc56eefd2dd91957:Vn,__wbg_set_credentials_c4a58d2e05ef24fb:Pn,__wbg_set_f43e577aea94465b:Dn,__wbg_set_handle_event_ea7145e4fd7c71f1:Wn,__wbg_set_headers_cfc5f4b2c1f20549:$n,__wbg_set_method_c3e20375f5ae7fac:Nn,__wbg_set_mode_b13642c312648202:Jn,__wbg_set_onclose_d382f3e2c2b850eb:Gn,__wbg_set_onerror_377f18bf4569bf85:Hn,__wbg_set_onmessage_2114aa5f4f53051e:Kn,__wbg_set_onopen_b7b52d519d6c0f11:Xn,__wbg_set_signal_f2d3f8599248896d:Yn,__wbg_set_wasm:ce,__wbg_signal_d1285ecab4ebc5ad:Qn,__wbg_stack_0ed75d68575b0f3c:Zn,__wbg_static_accessor_GLOBAL_12837167ad935116:e_,__wbg_static_accessor_GLOBAL_THIS_e628e89ab3b1c95f:t_,__wbg_static_accessor_SELF_a621d3dfbb60d0ce:n_,__wbg_static_accessor_WINDOW_f8727f0cf888e0bd:__,__wbg_status_89d7e803db911ee7:r_,__wbg_stringify_8d1cc6ff383e8bae:o_,__wbg_subarray_a96e1fef17ed23cb:c_,__wbg_then_0d9fe2c7b1857d32:i_,__wbg_then_b9e7b3b5f1a9e1b5:s_,__wbg_url_c484c26b1fbf5126:a_,__wbg_url_cb4d34db86c24df9:u_,__wbg_value_0546255b415e96c1:f_,__wbg_versions_4e31226f5e8dc909:b_,__wbg_view_6c32e7184b8606ad:d_,__wbg_warn_f7ae1b2e66ccb930:l_,__wbg_wasClean_a9c77a7100d8534f:g_,__wbindgen_cast_0000000000000001:w_,__wbindgen_cast_0000000000000002:y_,__wbindgen_cast_0000000000000003:p_,__wbindgen_cast_0000000000000004:m_,__wbindgen_cast_0000000000000005:h_,__wbindgen_cast_0000000000000006:v_,__wbindgen_cast_0000000000000007:k_,__wbindgen_cast_0000000000000008:S_,__wbindgen_cast_0000000000000009:F_,__wbindgen_cast_000000000000000a:E_,__wbindgen_cast_000000000000000b:C_,__wbindgen_init_externref_table:I_,main:Ce},Symbol.toStringTag,{value:"Module"})),G_=await GM.getResourceUrl("wasm"),H_=await(await fetch(G_)).arrayBuffer(),K_=await WebAssembly.compile(H_),ie=(await WebAssembly.instantiate(K_,{"./yno_vc_bg.js":J_})).exports;ce(ie),ie.__wbindgen_start();const X_={new(e){const t={element:document.createElement("audio"),buffer:void 0,media:void 0,queue:[]};return t.media=new MediaSource,t.media.addEventListener("sourceopen",()=>{const n=t.media.addSourceBuffer("audio/webm; codecs=opus");t.buffer=n,n.mode="sequence",n.addEventListener("updateend",se.bind(null,t));}),t.element.src=URL.createObjectURL(t.media),t.element.play().catch(()=>{}),{public_key:e.take_public_key(),send:e.take_send(),receive:e.take_receive(),audio:t,shouldClose:false}}};function se(e){try{if(!e.queue.length||e.buffer.updating)return;for(;e.queue.length>10;)e.queue.shift();const t=e.queue.shift();t&&e.buffer?.appendBuffer(t);}catch(t){console.log(t);}}const q=await GM.getValue("keys")||{},ae=new Set,ue=new Set;for(const e of Object.values(q))ue.has(e)?ae.add(e):ue.add(e);const J={},G={};for(const[e,t]of Object.entries(q))ae.has(t)||(J[e]=t,G[t]=e);function fe(e){return J[e]}function Y_(e){return G[e]}function Q_(e,t){q[e]=t,J[e]=t,G[t]=e,GM.setValue("keys",q);}function Z_(e){H("addOrUpdatePlayerListEntry",t=>t?.uuid&&e.on_player_join(t.uuid)&&Se(t.uuid)),H("removePlayerListEntry",t=>t&&e.on_player_leave(t)&&Fe(t)),H("clearPlayerList",()=>(e.on_players_cleared(),Ee()));}function H(e,t){const n=unsafeWindow[e];unsafeWindow[e]=function(_,o){return (!_||_.id=="playerList")&&t(o),n.apply(this,arguments)};}let be={};function er(){be=unsafeWindow.eval("globalPlayerData");}function de(e){return be[e]}const A=document.createElement("div");A.id="yno_vc_tab",A.className="playerList chatboxTabContent scrollableContainer";const le=document.createElement("div");le.style.flex="1",A.appendChild(le),document.getElementById("players").appendChild(A);const ge=document.createElement("style");ge.textContent=`
    #yno_vc_tab {
        display: none;
    }

    body:has(#yno_vc_tab_button.active) #playerList {
        display:none;
    }

    body:has(#yno_vc_tab_button.active) #yno_vc_tab {
        display: flex;
        flex-direction: column-reverse;
    }
`,document.head.appendChild(ge);const E=document.createElement("div");E.id="yno_vc_tab_button",E.onclick=function(){window.setPlayersTab(this,false);},E.className="playersTab subTab";const K=document.createElement("small");K.className="playersTabLabel subTabLabel infoLabel unselectable",K.textContent="Voice",E.appendChild(K);const we=document.createElement("div");we.className="subTabBg",E.appendChild(we),document.getElementById("playersTabs").appendChild(E);const X=e=>new Promise(t=>setTimeout(t,e)),x=document.createElement("button");x.textContent="Invite all players in this map",x.onclick=async()=>{const e=document.getElementById("chatInput");x.disabled=true,e.style.outline="solid 4px #08f";const t=e.value,n=`/voice:${I}`;for(let _=0;_<n.length;_++)e.value=n.slice(0,_),await X(_==6?200:10);await X(250),unsafeWindow.sendSessionCommand("say",[n]),e.style.outline="",e.value=t,await X(5e3),x.disabled=false;},A.appendChild(x);let C;const y=document.createElement("button");y.textContent="V",y.className="iconButton toggleButton offToggleButton unselectable",y.style.fontSize="22px",y.style.color="red",document.getElementById("leftControls").appendChild(y);let Y=false;y.addEventListener("click",()=>{Y=!Y,Y?(y.style.color="green",C?C.start(100):tr()):(y.style.color="red",C.stop());});async function tr(){C=new MediaRecorder(await navigator.mediaDevices.getUserMedia({audio:true}),{mimeType:"audio/webm; codecs=opus",audioBitsPerSecond:6e3}),C.addEventListener("dataavailable",ke),C.start(100);}const ye=await GM.getValue("secret_key"),V=await new z(ye).init();ye==null&&GM.setValue("secret_key",V.get_secret_key());const I=V.get_public_key(),pe=new L,g=new Set,nr=setInterval(()=>{unsafeWindow.chatboxAddMessage&&(clearInterval(nr),pe.init(),er(),_r(),Z_(pe));},1e3);function _r(){const e=unsafeWindow.chatboxAddMessage;unsafeWindow.chatboxAddMessage=function(t,n,_){const o=t.split(":");do{if(o[0]!="/voice")break;const c=o[1];if(c==I)break;Q_(_,c);const i=[...g].find(u=>u.public_key==c);i?i.uuid=_:me(_,c);}while(false);return e.apply(this,arguments)};}let Q=new Set;async function me(e,t){t!=I&&(Q.has(t)||[...g].find(n=>n.uuid==e||n.public_key==t)||(console.log(`Connecting to ${t}`),Q.add(t),V.connect(t).then(n=>{console.log(`Connected to ${t}`),he(n).uuid=e;}).catch(n=>{console.log(`Failed to connect to ${t}: ${n}`);}).then(()=>{Q.delete(t);})));}(async function(){for(;;)await V.accept().then(he).catch(e=>{console.log("Failed accepting connection: "+e);});})();function he(e){const t=X_.new(e);return rr(t),g.add(t),t}function Z(e,t){e.shouldClose=true,g.delete(e),t&&(t=t.replaceAll("%player%",de(e?.uuid)?.name||"an unidentified player"),console.log(t));}async function ve(e,t){try{await e.send.send(t);}catch(n){Z(e,`Voice disconnected %player% due to send error ${n}`);}}async function rr(e){try{for(;!e.shouldClose;){const t=await e.receive.read(),n=t.get("type"),_=t.get("data");({Hello(){e.uuid=fe(e.public_key),e.uuid||ve(e,{type:"Identify"});},Identify(){const o=Y_(e.public_key);if(!o)return Z(e);const c=unsafeWindow.showToastMessage(`${de(o).name} requires identification`),i=unsafeWindow.getSvgIcon("join",!0);i.className+=" iconButton",i.onclick=()=>{unsafeWindow.sendSessionCommand("say",["/voice:"+I]),c.remove();},c.insertBefore(i,c.querySelector(".closeToast"));},VoiceData(o){const c=new Uint8Array(o),{queue:i,element:u}=e.audio;i.push(c),u.paused&&u.play().catch(()=>{}),se(e.audio);}}[n]||(()=>{throw `unexpected ${n} packet`}))(_);}}catch(t){Z(e,`Voice disconnected %player% due to receive error ${t}`);}}async function ke(e){if(!e.data.size)return;const t={type:"VoiceData",data:Array.from(await e.data.bytes())},n=[...g].map(_=>ve(_,t));for(const _ of n)await _;}function Se(e){const t=[...g].find(n=>n.uuid==e.uuid);if(t)t.expiration&&(clearTimeout(t.expiration),t.expiration=void 0);else {const n=fe(e.uuid);if(!n||n>=I)return;me(e.uuid,n);}}function Fe(e){const t=[...g].find(n=>n.uuid==e);t&&(t.expiration=setTimeout(()=>{g.delete(t);},3e4));}function Ee(){for(const e of [...g])e.expiration=setTimeout(()=>{g.delete(e);},3e4);}return p.onMicrophoneData=ke,p.onPlayerJoin=Se,p.onPlayerLeave=Fe,p.onPlayersCleared=Ee,p.public_key=I,Object.defineProperty(p,Symbol.toStringTag,{value:"Module"}),p}))({});

})();